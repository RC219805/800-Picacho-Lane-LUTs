# Static Analysis Configuration

This document describes the static analysis tools configured for this project and how to use them.

## Configured Tools

### MyPy (Type Checking)

**Configuration:** `setup.cfg` (primary) and `pyproject.toml` (backup)

MyPy is configured for gradual typing adoption with the following settings:
- Python version: 3.10
- Warns on unreachable code, unused configs, and redundant casts
- Allows untyped functions (for gradual adoption)
- Ignores missing imports for third-party libraries without type stubs

**Usage:**
```bash
# Check specific files
mypy luxury_tiff_batch_processor.py material_response.py

# Check entire package
mypy luxury_tiff_batch_processor/

# Check with config
mypy --config-file=setup.cfg .
```

### Flake8 (Style and Syntax Checking)

**Configuration:** `setup.cfg`

Flake8 is configured to enforce PEP 8 with project-specific adjustments:
- Max line length: 127 characters (GitHub editor width)
- Ignores: E203 (whitespace before ':'), W503 (line break before binary operator)
- Excludes: build artifacts, virtual environments, image directories

**Usage:**
```bash
# Critical errors only (as in CI)
flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics

# Full check with warnings
flake8 . --count --max-complexity=10 --max-line-length=127 --statistics

# Check specific files
flake8 luxury_tiff_batch_processor.py material_response.py
```

### Pylint (Comprehensive Linting)

**Configuration:** `pyproject.toml`

Pylint is configured with relaxed settings for research/creative code:
- Max line length: 127 characters
- Disabled checks: docstring requirements, complexity limits
- Increased limits: max-args=15, max-locals=25, max-branches=20

**Usage:**
```bash
# Check all Python files
pylint $(git ls-files '*.py')

# Check specific files
pylint luxury_tiff_batch_processor.py material_response.py

# Check with config
pylint --rcfile=pyproject.toml luxury_tiff_batch_processor/
```

## Running All Checks

To run all static analysis tools:

```bash
# Critical errors only
flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics

# Type checking
mypy luxury_tiff_batch_processor.py material_response.py material_response_optimizer.py

# Comprehensive linting (may show many warnings)
pylint $(git ls-files '*.py') --exit-zero
```

## CI/CD Integration

Static analysis is integrated into GitHub Actions workflows:

- **python-app.yml**: Runs flake8 and pytest on every push/PR to main
- **pylint.yml**: Runs pylint on Python 3.10, 3.11, 3.12

## Configuration Files

- `setup.cfg`: Primary configuration for flake8 and mypy (INI format)
- `pyproject.toml`: Configuration for pylint and backup mypy config (TOML format)
- `.static-analysis.md`: This documentation file

## Fixed Issues

The following static analysis issues have been resolved:

1. **MyPy error in luxury_tiff_batch_processor.py**: Fixed main function return type (changed from `None` to `int`)
2. **Duplicate value in material_response.py:257**: Removed duplicate 'so' entry from `_STOP_WORDS` set
3. **Unreachable code in material_response.py:1009**: Moved `_boxcount` method from inside `apply_transformation_tensor` function to `MaterialResponseValidator` class where it belongs

## Notes

- The project uses gradual typing, so not all functions require type annotations
- Flake8 and MyPy configurations prioritize catching actual errors over style uniformity
- Pylint is configured with relaxed limits to accommodate the creative/research nature of the codebase
- Some mypy errors in third-party library integration are expected and can be safely ignored with `# type: ignore` comments
